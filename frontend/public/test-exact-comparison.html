<!DOCTYPE html>
<html>
<head>
    <title>Exact Comparison Test</title>
</head>
<body>
    <h1>Comparing Working vs Non-Working Methods</h1>

    <h2>Main Themes (WORKS):</h2>
    <select id="themeSelect">
        <option value="all">All Themes</option>
    </select>

    <h2>Border Themes (DOESN'T WORK):</h2>
    <select id="borderThemeSelect">
        <option value="none">None</option>
    </select>

    <button onclick="runTest()">Run Test</button>
    <button onclick="checkSelects()">Check Selects</button>

    <pre id="log"></pre>

    <script>
        function log(msg) {
            document.getElementById('log').textContent += msg + '\n';
            console.log(msg);
        }

        // Mock worksheetApp to match v2 apps
        const worksheetApp = {
            getThemes: async () => {
                const response = await fetch('/api/themes');
                return response.json();
            }
        };

        // EXACT copy of working loadThemes from subtraction-v2
        async function loadThemes() {
            log('\n=== LOADING MAIN THEMES (WORKING METHOD) ===');
            const themeSelect = document.getElementById('themeSelect');
            const themes = await worksheetApp.getThemes();

            log('Main themes received: ' + themes.length);

            // Keep "All Themes" option
            themeSelect.innerHTML = '<option value="all">All Themes</option>';

            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.folder_name || theme.value;
                option.textContent = theme.display_name || theme.displayName || theme.folder_name;
                themeSelect.appendChild(option);
                log('Added main theme: ' + option.textContent);
            });

            log('Main theme select final count: ' + themeSelect.options.length);
        }

        // EXACT copy of non-working populateBorderThemes from subtraction-v2
        function populateBorderThemes() {
            log('\n=== LOADING BORDER THEMES (NON-WORKING METHOD) ===');

            fetch('/api/borders/themes')
                .then(response => {
                    log('Border response received: ' + response.ok);
                    if (!response.ok) {
                        log('Failed to load border themes');
                        return;
                    }
                    return response.json();
                })
                .then(themes => {
                    log('Border themes parsed: ' + (themes ? themes.length : 'null'));
                    if (!themes) return;

                    const borderSelect = document.getElementById('borderThemeSelect');
                    log('Border select found: ' + !!borderSelect);

                    if (!borderSelect) {
                        log('borderThemeSelect not found!');
                        return;
                    }

                    // Clear and rebuild
                    borderSelect.innerHTML = '';

                    // Add None option
                    const noneOption = document.createElement('option');
                    noneOption.value = 'none';
                    noneOption.textContent = 'None';
                    borderSelect.appendChild(noneOption);

                    themes.forEach(theme => {
                        const themeValue = theme.value;
                        const displayName = theme.displayName;

                        const option = document.createElement('option');
                        option.value = themeValue;
                        option.textContent = displayName;
                        borderSelect.appendChild(option);
                        log('Added border theme: ' + displayName);
                    });

                    log('Border select final count: ' + borderSelect.options.length);
                })
                .catch(error => {
                    log('Error loading border themes: ' + error);
                });
        }

        async function runTest() {
            log('Starting test...\n');

            // Test working method
            await loadThemes();

            // Test non-working method
            populateBorderThemes();

            // Check after delay
            setTimeout(() => {
                log('\n=== FINAL CHECK AFTER 1 SECOND ===');
                checkSelects();
            }, 1000);
        }

        function checkSelects() {
            const themeSelect = document.getElementById('themeSelect');
            const borderSelect = document.getElementById('borderThemeSelect');

            log('\nMain themes select:');
            log('  Options: ' + themeSelect.options.length);
            log('  Values: ' + Array.from(themeSelect.options).map(o => o.value).join(', '));

            log('\nBorder themes select:');
            log('  Options: ' + borderSelect.options.length);
            log('  Values: ' + Array.from(borderSelect.options).map(o => o.value).join(', '));
        }

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', runTest);
    </script>
</body>
</html>