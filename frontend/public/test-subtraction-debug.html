<!DOCTYPE html>
<html>
<head>
  <title>Subtraction Debug Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select { width: 200px; padding: 5px; margin: 10px 0; }
    .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
  </style>
</head>
<body>
  <h1>Subtraction Debug Test</h1>

  <label>Border Theme:</label>
  <select id="borderThemeSelect">
    <option value="none">None</option>
  </select>

  <label>Background Theme:</label>
  <select id="backgroundThemeSelect">
    <option value="none">None</option>
  </select>

  <div id="log" class="log">Waiting for actions...</div>

  <script>
    const log = document.getElementById('log');
    const borderThemeSelect = document.getElementById('borderThemeSelect');
    const backgroundThemeSelect = document.getElementById('backgroundThemeSelect');

    function addLog(msg) {
      const time = new Date().toLocaleTimeString();
      log.innerHTML += `<br>[${time}] ${msg}`;
    }

    // Load border themes
    async function loadBorderThemes() {
      addLog('Loading border themes...');
      try {
        const response = await fetch('/api/borders/themes');
        const themes = await response.json();
        addLog(`Got ${themes.length} border themes: ${JSON.stringify(themes)}`);
        themes.forEach(theme => {
          const option = document.createElement('option');
          option.value = theme.value || theme;
          option.textContent = theme.displayName || theme;
          borderThemeSelect.appendChild(option);
        });
        addLog('Border themes loaded');
      } catch (err) {
        addLog('ERROR loading border themes: ' + err.message);
      }
    }

    // Load background themes
    async function loadBackgroundThemes() {
      addLog('Loading background themes...');
      try {
        const response = await fetch('/api/backgrounds/themes');
        const themes = await response.json();
        addLog(`Got ${themes.length} background themes: ${JSON.stringify(themes)}`);
        themes.forEach(theme => {
          const option = document.createElement('option');
          option.value = theme.value || theme;
          option.textContent = theme.displayName || theme;
          backgroundThemeSelect.appendChild(option);
        });
        addLog('Background themes loaded');
      } catch (err) {
        addLog('ERROR loading background themes: ' + err.message);
      }
    }

    // Load border images
    async function loadBorderImages() {
      const theme = borderThemeSelect.value;
      addLog(`Border theme changed to: ${theme}`);
      if (theme === 'none') return;

      try {
        const url = `/api/borders/images?theme=${theme}`;
        addLog(`Fetching from: ${url}`);
        const response = await fetch(url);
        const data = await response.json();
        addLog(`Got border images response: ${JSON.stringify(data).substring(0, 200)}...`);
        const images = data.images || data;
        addLog(`Extracted ${images.length} border images`);
      } catch (err) {
        addLog('ERROR loading border images: ' + err.message);
      }
    }

    // Load background images
    async function loadBackgroundImages() {
      const theme = backgroundThemeSelect.value;
      addLog(`Background theme changed to: ${theme}`);
      if (theme === 'none') return;

      try {
        const url = `/api/backgrounds/images?theme=${theme}`;
        addLog(`Fetching from: ${url}`);
        const response = await fetch(url);
        const data = await response.json();
        addLog(`Got background images response: ${JSON.stringify(data).substring(0, 200)}...`);
        const images = data.images || data;
        addLog(`Extracted ${images.length} background images`);
      } catch (err) {
        addLog('ERROR loading background images: ' + err.message);
      }
    }

    // Set up event listeners
    borderThemeSelect.addEventListener('change', () => {
      addLog('Border select change event fired!');
      loadBorderImages();
    });

    backgroundThemeSelect.addEventListener('change', () => {
      addLog('Background select change event fired!');
      loadBackgroundImages();
    });

    // Initialize
    addLog('Page loaded, initializing...');
    loadBorderThemes();
    loadBackgroundThemes();
  </script>
</body>
</html>