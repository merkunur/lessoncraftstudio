<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Wordsearch Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Wordsearch App Fix Verification</h1>

    <div class="test-section">
        <h2>Test 1: English Locale</h2>
        <iframe id="englishFrame" src="/worksheet-generators/wordsearch.html?locale=en"></iframe>
        <button onclick="checkFrame('englishFrame', 'en')">Check English Version</button>
        <div id="englishResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Swedish Locale</h2>
        <iframe id="swedishFrame" src="/worksheet-generators/wordsearch.html?locale=sv"></iframe>
        <button onclick="checkFrame('swedishFrame', 'sv')">Check Swedish Version</button>
        <div id="swedishResult"></div>
    </div>

    <div class="test-section">
        <h2>API Test Results</h2>
        <button onclick="testAPIs()">Test All APIs</button>
        <div id="apiResults"></div>
    </div>

    <script>
    async function checkFrame(frameId, expectedLocale) {
        const frame = document.getElementById(frameId);
        const resultDiv = document.getElementById(frameId.replace('Frame', 'Result'));

        try {
            const frameDoc = frame.contentDocument || frame.contentWindow.document;

            // Check if BulletproofLoader exists
            const hasLoader = frame.contentWindow.BulletproofLoader !== undefined;

            // Check if selects exist
            const borderSelect = frameDoc.getElementById('borderThemeSelect');
            const bgSelect = frameDoc.getElementById('backgroundThemeSelect');

            // Check if selects have options
            const borderOptions = borderSelect ? borderSelect.options.length : 0;
            const bgOptions = bgSelect ? bgSelect.options.length : 0;

            // Check locale
            const actualLocale = frame.contentWindow.currentLocale || 'unknown';

            let html = '<h3>Results:</h3><ul>';
            html += `<li>BulletproofLoader: ${hasLoader ? '<span class="success">âœ“ Loaded</span>' : '<span class="fail">âœ— Not Found</span>'}</li>`;
            html += `<li>Border Select: ${borderOptions > 1 ? `<span class="success">âœ“ ${borderOptions} options</span>` : '<span class="fail">âœ— Not populated</span>'}</li>`;
            html += `<li>Background Select: ${bgOptions > 1 ? `<span class="success">âœ“ ${bgOptions} options</span>` : '<span class="fail">âœ— Not populated</span>'}</li>`;
            html += `<li>Locale: ${actualLocale === expectedLocale ? `<span class="success">âœ“ ${actualLocale}</span>` : `<span class="fail">âœ— ${actualLocale} (expected ${expectedLocale})</span>`}</li>`;

            // Check for Swedish translation if Swedish locale
            if (expectedLocale === 'sv' && borderSelect && borderOptions > 1) {
                const hasSwedishTranslation = Array.from(borderSelect.options).some(opt =>
                    opt.textContent.toLowerCase().includes('vÃ¥r')
                );
                html += `<li>Swedish Translation: ${hasSwedishTranslation ? '<span class="success">âœ“ Found "vÃ¥r"</span>' : '<span class="fail">âœ— Not found</span>'}</li>`;
            }

            html += '</ul>';
            resultDiv.innerHTML = html;

        } catch (error) {
            resultDiv.innerHTML = `<span class="fail">Error: ${error.message}</span>`;
        }
    }

    async function testAPIs() {
        const resultsDiv = document.getElementById('apiResults');
        let html = '<h3>API Test Results:</h3><ul>';

        // Test English borders
        try {
            const enBorders = await fetch('/api/borders/themes?locale=en');
            const enBordersData = await enBorders.json();
            html += `<li>English Borders: <span class="success">âœ“ ${enBordersData.length} themes</span></li>`;
        } catch (e) {
            html += `<li>English Borders: <span class="fail">âœ— Failed</span></li>`;
        }

        // Test Swedish borders
        try {
            const svBorders = await fetch('/api/borders/themes?locale=sv');
            const svBordersData = await svBorders.json();
            const hasVÃ¥r = svBordersData.some(t => t.displayName === 'vÃ¥r');
            html += `<li>Swedish Borders: <span class="success">âœ“ ${svBordersData.length} themes${hasVÃ¥r ? ' (includes "vÃ¥r")' : ''}</span></li>`;
        } catch (e) {
            html += `<li>Swedish Borders: <span class="fail">âœ— Failed</span></li>`;
        }

        // Test English backgrounds
        try {
            const enBg = await fetch('/api/backgrounds/themes?locale=en');
            const enBgData = await enBg.json();
            html += `<li>English Backgrounds: <span class="success">âœ“ ${enBgData.length} themes</span></li>`;
        } catch (e) {
            html += `<li>English Backgrounds: <span class="fail">âœ— Failed</span></li>`;
        }

        // Test Swedish backgrounds
        try {
            const svBg = await fetch('/api/backgrounds/themes?locale=sv');
            const svBgData = await svBg.json();
            html += `<li>Swedish Backgrounds: <span class="success">âœ“ ${svBgData.length} themes</span></li>`;
        } catch (e) {
            html += `<li>Swedish Backgrounds: <span class="fail">âœ— Failed</span></li>`;
        }

        html += '</ul>';
        resultsDiv.innerHTML = html;
    }

    // Auto-test APIs on load
    window.onload = () => {
        setTimeout(testAPIs, 1000);
    };
    </script>
</body>
</html>