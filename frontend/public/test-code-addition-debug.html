<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Addition Debug</title>
</head>
<body>
    <h1>Code Addition Debug Test</h1>
    <iframe src="/api/worksheet/code%20addition.html" width="100%" height="800" id="testFrame"></iframe>
    
    <script>
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.message, e.filename, e.lineno, e.colno);
        });
        
        const iframe = document.getElementById('testFrame');
        iframe.onload = function() {
            console.log('Iframe loaded');
            
            // Try to access iframe content
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const iframeWindow = iframe.contentWindow;
                
                // Listen for errors in iframe
                iframeWindow.addEventListener('error', function(e) {
                    console.error('Iframe error:', e.message, 'at line', e.lineno);
                });
                
                // Check if key functions exist
                console.log('Checking functions...');
                console.log('generateWorksheet exists?', typeof iframeWindow.generateWorksheet);
                
                // Try to generate worksheet
                setTimeout(() => {
                    console.log('Attempting to generate worksheet...');
                    const btn = iframeDoc.getElementById('generateWorksheetBtn');
                    if (btn) {
                        console.log('Found generate button, clicking...');
                        btn.click();
                    }
                }, 2000);
                
            } catch (e) {
                console.error('Error accessing iframe:', e);
            }
        };
    </script>
</body>
</html>