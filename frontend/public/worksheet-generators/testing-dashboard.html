<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LessonCraftStudio - Testing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .locale-selector {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
        }
        .stat-card.success .value { color: #28a745; }
        .stat-card.warning .value { color: #ffc107; }
        .stat-card.error .value { color: #dc3545; }
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
        }
        .app-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .app-card-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .app-name {
            font-weight: 600;
            color: #333;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-badge.working { background: #d4edda; color: #155724; }
        .status-badge.partial { background: #fff3cd; color: #856404; }
        .status-badge.broken { background: #f8d7da; color: #721c24; }
        .status-badge.untested { background: #e9ecef; color: #495057; }
        .app-card-body {
            padding: 15px;
        }
        .test-results {
            list-style: none;
            font-size: 14px;
        }
        .test-results li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .test-results .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }
        .icon.pass { color: #28a745; }
        .icon.fail { color: #dc3545; }
        .icon.pending { color: #6c757d; }
        .app-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .app-actions button {
            flex: 1;
            font-size: 12px;
            padding: 6px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ LessonCraftStudio Testing Dashboard</h1>
        <p style="color: #666; margin: 10px 0;">Comprehensive testing for all 33 worksheet generator apps</p>

        <div class="controls">
            <label>Test Locale:
                <select id="testLocale" class="locale-selector">
                    <option value="en">English</option>
                    <option value="sv">Svenska</option>
                    <option value="de">Deutsch</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="es">Espa√±ol</option>
                    <option value="pt">Portugu√™s</option>
                    <option value="it">Italiano</option>
                    <option value="nl">Nederlands</option>
                    <option value="da">Dansk</option>
                    <option value="no">Norsk</option>
                    <option value="fi">Suomi</option>
                </select>
            </label>
            <button onclick="testAllApps()">üîÑ Test All Apps</button>
            <button onclick="testBrokenOnly()">‚ö†Ô∏è Test Broken Only</button>
            <button onclick="exportReport()">üìä Export Report</button>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card success">
            <h3>Working</h3>
            <div class="value" id="workingCount">0</div>
        </div>
        <div class="stat-card warning">
            <h3>Partial</h3>
            <div class="value" id="partialCount">0</div>
        </div>
        <div class="stat-card error">
            <h3>Broken</h3>
            <div class="value" id="brokenCount">0</div>
        </div>
        <div class="stat-card">
            <h3>Total Apps</h3>
            <div class="value">33</div>
        </div>
    </div>

    <div id="appGrid" class="app-grid">
        <div class="loading">Loading apps...</div>
    </div>

    <script>
    // List of all 33 worksheet generator apps
    const apps = [
        { name: 'Addition', file: 'addition.html', status: 'working' },
        { name: 'Alphabet Train', file: 'alphabet train.html', status: 'working' },
        { name: 'Big Small', file: 'big small.html', status: 'untested' },
        { name: 'Bingo', file: 'bingo.html', status: 'untested' },
        { name: 'Chart Count', file: 'chart count.html', status: 'untested' },
        { name: 'Code Addition', file: 'code addition.html', status: 'untested' },
        { name: 'Coloring', file: 'coloring.html', status: 'working' },
        { name: 'Crossword', file: 'crossword.html', status: 'untested' },
        { name: 'Cryptogram', file: 'cryptogram.html', status: 'untested' },
        { name: 'Draw and Color', file: 'draw and color.html', status: 'untested' },
        { name: 'Drawing Lines', file: 'drawing lines.html', status: 'untested' },
        { name: 'Find and Count', file: 'find and count.html', status: 'broken' },
        { name: 'Find Objects', file: 'find objects.html', status: 'untested' },
        { name: 'Grid Match', file: 'grid match.html', status: 'untested' },
        { name: 'Matching', file: 'matching.html', status: 'untested' },
        { name: 'Math Puzzle', file: 'math puzzle.html', status: 'untested' },
        { name: 'Math Worksheet', file: 'math worksheet.html', status: 'untested' },
        { name: 'Missing Pieces', file: 'missing pieces.html', status: 'untested' },
        { name: 'More Less', file: 'more less.html', status: 'untested' },
        { name: 'Odd One Out', file: 'odd one out.html', status: 'untested' },
        { name: 'Pattern Train', file: 'pattern train.html', status: 'untested' },
        { name: 'Pattern Worksheet', file: 'pattern worksheet.html', status: 'untested' },
        { name: 'Picture Path', file: 'picture path.html', status: 'untested' },
        { name: 'Picture Sort', file: 'picture sort.html', status: 'untested' },
        { name: 'Prepositions', file: 'prepositions.html', status: 'untested' },
        { name: 'Shadow Match', file: 'shadow match.html', status: 'untested' },
        { name: 'Subtraction', file: 'subtraction.html', status: 'working' },
        { name: 'Sudoku', file: 'sudoku.html', status: 'untested' },
        { name: 'Word Guess', file: 'word guess.html', status: 'untested' },
        { name: 'Word Scramble', file: 'word scramble.html', status: 'untested' },
        { name: 'Word Search', file: 'wordsearch.html', status: 'working' },
        { name: 'Writing', file: 'writing.html', status: 'untested' },
        { name: 'Image Addition', file: 'image-addition.html', status: 'working' }
    ];

    // Test results for each app
    const testResults = {};

    // Initialize dashboard
    function initDashboard() {
        renderApps();
        updateStats();
    }

    // Render app cards
    function renderApps() {
        const grid = document.getElementById('appGrid');
        grid.innerHTML = '';

        apps.forEach(app => {
            const card = createAppCard(app);
            grid.appendChild(card);
        });
    }

    // Create app card element
    function createAppCard(app) {
        const card = document.createElement('div');
        card.className = 'app-card';
        card.id = `app-${app.file.replace(/\s/g, '-')}`;

        const statusClass = getStatusClass(app.status);

        card.innerHTML = `
            <div class="app-card-header">
                <span class="app-name">${app.name}</span>
                <span class="status-badge ${statusClass}">${app.status.toUpperCase()}</span>
            </div>
            <div class="app-card-body">
                <ul class="test-results">
                    <li><span class="icon pending">‚óã</span> Border themes localized</li>
                    <li><span class="icon pending">‚óã</span> Background themes localized</li>
                    <li><span class="icon pending">‚óã</span> Image themes localized</li>
                    <li><span class="icon pending">‚óã</span> API calls use locale</li>
                </ul>
                <div class="app-actions">
                    <button onclick="testApp('${app.file}')">Test</button>
                    <button onclick="openApp('${app.file}')">Open</button>
                    <button onclick="fixApp('${app.file}')">Fix</button>
                </div>
            </div>
        `;

        return card;
    }

    // Get status class for badge
    function getStatusClass(status) {
        switch(status) {
            case 'working': return 'working';
            case 'partial': return 'partial';
            case 'broken': return 'broken';
            default: return 'untested';
        }
    }

    // Test a single app
    async function testApp(file) {
        const locale = document.getElementById('testLocale').value;
        console.log(`Testing ${file} with locale ${locale}`);

        // Update UI to show testing
        const card = document.getElementById(`app-${file.replace(/\s/g, '-')}`);
        if (card) {
            const results = card.querySelector('.test-results');
            results.innerHTML = '<li>Testing...</li>';
        }

        // Perform actual tests (simulated for now)
        // In production, this would actually test the endpoints
        setTimeout(() => {
            updateTestResults(file, {
                borderThemes: Math.random() > 0.3,
                backgroundThemes: Math.random() > 0.3,
                imageThemes: Math.random() > 0.3,
                apiCalls: Math.random() > 0.3
            });
        }, 1000);
    }

    // Update test results for an app
    function updateTestResults(file, results) {
        testResults[file] = results;

        const card = document.getElementById(`app-${file.replace(/\s/g, '-')}`);
        if (!card) return;

        const resultsList = card.querySelector('.test-results');
        resultsList.innerHTML = `
            <li><span class="icon ${results.borderThemes ? 'pass' : 'fail'}">${results.borderThemes ? '‚úì' : '‚úó'}</span> Border themes localized</li>
            <li><span class="icon ${results.backgroundThemes ? 'pass' : 'fail'}">${results.backgroundThemes ? '‚úì' : '‚úó'}</span> Background themes localized</li>
            <li><span class="icon ${results.imageThemes ? 'pass' : 'fail'}">${results.imageThemes ? '‚úì' : '‚úó'}</span> Image themes localized</li>
            <li><span class="icon ${results.apiCalls ? 'pass' : 'fail'}">${results.apiCalls ? '‚úì' : '‚úó'}</span> API calls use locale</li>
        `;

        // Update status
        const allPass = results.borderThemes && results.backgroundThemes && results.imageThemes && results.apiCalls;
        const somePass = results.borderThemes || results.backgroundThemes || results.imageThemes || results.apiCalls;

        let newStatus = 'broken';
        if (allPass) newStatus = 'working';
        else if (somePass) newStatus = 'partial';

        const badge = card.querySelector('.status-badge');
        badge.className = `status-badge ${getStatusClass(newStatus)}`;
        badge.textContent = newStatus.toUpperCase();

        // Update app status in array
        const app = apps.find(a => a.file === file);
        if (app) app.status = newStatus;

        updateStats();
    }

    // Test all apps
    async function testAllApps() {
        for (const app of apps) {
            await testApp(app.file);
            await new Promise(resolve => setTimeout(resolve, 500)); // Rate limiting
        }
    }

    // Test only broken apps
    async function testBrokenOnly() {
        const brokenApps = apps.filter(app => app.status === 'broken' || app.status === 'untested');
        for (const app of brokenApps) {
            await testApp(app.file);
            await new Promise(resolve => setTimeout(resolve, 500));
        }
    }

    // Open app in new window
    function openApp(file) {
        const locale = document.getElementById('testLocale').value;
        window.open(`/worksheet-generators/${file}?locale=${locale}`, '_blank');
    }

    // Navigate to fix the app
    function fixApp(file) {
        console.log(`Fixing ${file} - would implement migration here`);
        alert(`To fix ${file}:\n\n1. Add locale-manager.js and app-initializer.js\n2. Remove old locale handling code\n3. Use AppInitializer.init()\n4. Test with dashboard`);
    }

    // Update statistics
    function updateStats() {
        const working = apps.filter(a => a.status === 'working').length;
        const partial = apps.filter(a => a.status === 'partial').length;
        const broken = apps.filter(a => a.status === 'broken').length;

        document.getElementById('workingCount').textContent = working;
        document.getElementById('partialCount').textContent = partial;
        document.getElementById('brokenCount').textContent = broken;
    }

    // Export test report
    function exportReport() {
        const locale = document.getElementById('testLocale').value;
        const report = {
            timestamp: new Date().toISOString(),
            locale: locale,
            summary: {
                working: apps.filter(a => a.status === 'working').length,
                partial: apps.filter(a => a.status === 'partial').length,
                broken: apps.filter(a => a.status === 'broken').length,
                untested: apps.filter(a => a.status === 'untested').length
            },
            apps: apps.map(app => ({
                name: app.name,
                file: app.file,
                status: app.status,
                testResults: testResults[app.file] || null
            }))
        };

        const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `lcs-test-report-${locale}-${Date.now()}.json`;
        a.click();
    }

    // Initialize on load
    initDashboard();
    </script>
</body>
</html>