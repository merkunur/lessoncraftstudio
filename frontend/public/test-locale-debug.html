<!DOCTYPE html>
<html>
<head>
    <title>Locale Debug Test</title>
    <script src="worksheet-generators/js/translations.js"></script>
</head>
<body>
    <h1>Locale Debug Test</h1>

    <div>
        <p>URL: <span id="url"></span></p>
        <p>getCurrentLocale(): <span id="getCurrentLocale"></span></p>
        <p>URL Param locale: <span id="urlParam"></span></p>
    </div>

    <h2>Border Themes:</h2>
    <select id="borderThemeSelect">
        <option value="none">None</option>
    </select>

    <h2>Background Themes:</h2>
    <select id="backgroundThemeSelect">
        <option value="none">None</option>
    </select>

    <div id="log"></div>

    <script>
    function log(msg) {
        console.log(msg);
        document.getElementById('log').innerHTML += '<div>' + msg + '</div>';
    }

    // Display URL info
    document.getElementById('url').textContent = window.location.href;

    // Check getCurrentLocale
    if (typeof getCurrentLocale !== 'undefined') {
        const locale = getCurrentLocale();
        document.getElementById('getCurrentLocale').textContent = locale;
        log('getCurrentLocale() returns: ' + locale);
    } else {
        document.getElementById('getCurrentLocale').textContent = 'NOT DEFINED';
        log('getCurrentLocale() is NOT DEFINED');
    }

    // Check URL param directly
    const urlParams = new URLSearchParams(window.location.search);
    const urlLocale = urlParams.get('locale');
    document.getElementById('urlParam').textContent = urlLocale || 'null';
    log('URL param locale: ' + (urlLocale || 'null'));

    // Helper function
    function getLocale() {
        if (typeof getCurrentLocale !== 'undefined') {
            return getCurrentLocale();
        }
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('locale') || 'en';
    }

    async function loadBorderThemes() {
        const locale = getLocale();
        log('Loading border themes with locale: ' + locale);

        const url = '/api/borders/themes?locale=' + locale;
        log('Fetching: ' + url);

        try {
            const response = await fetch(url);
            const themes = await response.json();
            log('Received ' + themes.length + ' border themes');
            log('Border themes: ' + JSON.stringify(themes));

            const select = document.getElementById('borderThemeSelect');
            select.innerHTML = '<option value="none">None</option>';

            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.value;
                option.textContent = theme.displayName;
                select.appendChild(option);
                log('Added border option: ' + theme.value + ' = ' + theme.displayName);
            });
        } catch (error) {
            log('Error: ' + error.message);
        }
    }

    async function loadBackgroundThemes() {
        const locale = getLocale();
        log('Loading background themes with locale: ' + locale);

        const url = '/api/backgrounds/themes?locale=' + locale;
        log('Fetching: ' + url);

        try {
            const response = await fetch(url);
            const themes = await response.json();
            log('Received ' + themes.length + ' background themes');
            log('Background themes: ' + JSON.stringify(themes));

            const select = document.getElementById('backgroundThemeSelect');
            select.innerHTML = '<option value="none">None</option>';

            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.value;
                option.textContent = theme.displayName;
                select.appendChild(option);
                log('Added background option: ' + theme.value + ' = ' + theme.displayName);
            });
        } catch (error) {
            log('Error: ' + error.message);
        }
    }

    // Load on page load
    loadBorderThemes();
    loadBackgroundThemes();
    </script>
</body>
</html>