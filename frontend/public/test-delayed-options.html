<!DOCTYPE html>
<html>
<head>
    <title>Delayed Options Test</title>
</head>
<body>
    <h1>Testing Delayed Option Addition</h1>

    <select id="testSelect">
        <option value="none">None</option>
    </select>

    <button onclick="addInstantly()">Add All Instantly</button>
    <button onclick="addWithDelay()">Add With Delay</button>
    <button onclick="addWithRAF()">Add With RequestAnimationFrame</button>
    <button onclick="clearSelect()">Clear</button>

    <pre id="log"></pre>

    <script>
        function log(msg) {
            document.getElementById('log').textContent += msg + '\n';
        }

        function clearSelect() {
            const select = document.getElementById('testSelect');
            select.innerHTML = '<option value="none">None</option>';
            log('Select cleared');
        }

        async function addInstantly() {
            log('\nAdding all options instantly...');
            const response = await fetch('/api/borders/themes');
            const themes = await response.json();

            const select = document.getElementById('testSelect');
            select.innerHTML = '<option value="none">None</option>';

            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.value;
                option.textContent = theme.displayName;
                select.appendChild(option);
            });

            log('Added ' + (themes.length) + ' themes');
            log('Total options: ' + select.options.length);
        }

        async function addWithDelay() {
            log('\nAdding options with 10ms delay...');
            const response = await fetch('/api/borders/themes');
            const themes = await response.json();

            const select = document.getElementById('testSelect');
            select.innerHTML = '<option value="none">None</option>';

            for (let i = 0; i < themes.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 10));
                const theme = themes[i];
                const option = document.createElement('option');
                option.value = theme.value;
                option.textContent = theme.displayName;
                select.appendChild(option);
                log('Added: ' + theme.displayName);
            }

            log('Total options: ' + select.options.length);
        }

        async function addWithRAF() {
            log('\nAdding options with requestAnimationFrame...');
            const response = await fetch('/api/borders/themes');
            const themes = await response.json();

            const select = document.getElementById('testSelect');
            select.innerHTML = '<option value="none">None</option>';

            for (const theme of themes) {
                await new Promise(resolve => requestAnimationFrame(resolve));
                const option = document.createElement('option');
                option.value = theme.value;
                option.textContent = theme.displayName;
                select.appendChild(option);
            }

            log('Added ' + themes.length + ' themes');
            log('Total options: ' + select.options.length);
        }

        // Test on load
        window.addEventListener('DOMContentLoaded', () => {
            log('Page loaded. Select element found: ' + !!document.getElementById('testSelect'));
        });
    </script>
</body>
</html>