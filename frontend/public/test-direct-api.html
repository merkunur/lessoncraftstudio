<!DOCTYPE html>
<html>
<head>
    <title>Direct API Test</title>
</head>
<body>
    <h1>Direct API and Select Test</h1>

    <h2>Border Themes Select:</h2>
    <select id="borderThemeSelect">
        <option value="none">None</option>
    </select>

    <h2>Background Themes Select:</h2>
    <select id="backgroundThemeSelect">
        <option value="none">None</option>
    </select>

    <button onclick="testDirectAPI()">Load Themes Directly</button>
    <button onclick="checkSelects()">Check Select States</button>

    <pre id="log"></pre>

    <script>
        function log(msg) {
            const logEl = document.getElementById('log');
            logEl.textContent += msg + '\n';
            console.log(msg);
        }

        async function testDirectAPI() {
            log('Testing direct API calls...\n');

            // Test border themes
            try {
                const borderResponse = await fetch('/api/borders/themes');
                const borderThemes = await borderResponse.json();
                log('Border themes from API: ' + JSON.stringify(borderThemes));

                const borderSelect = document.getElementById('borderThemeSelect');
                log('Border select element exists: ' + !!borderSelect);

                // Clear and rebuild
                while (borderSelect.options.length > 0) {
                    borderSelect.remove(0);
                }

                // Add None
                const noneOpt = new Option('None', 'none');
                borderSelect.add(noneOpt);

                // Add themes
                borderThemes.forEach(theme => {
                    const opt = new Option(theme.displayName, theme.value);
                    borderSelect.add(opt);
                    log('Added option: ' + theme.displayName);
                });

                log('Final border select options: ' + borderSelect.options.length);

            } catch (err) {
                log('Border error: ' + err);
            }

            // Test background themes
            try {
                const bgResponse = await fetch('/api/backgrounds/themes');
                const bgThemes = await bgResponse.json();
                log('\nBackground themes from API: ' + JSON.stringify(bgThemes));

                const bgSelect = document.getElementById('backgroundThemeSelect');
                log('Background select element exists: ' + !!bgSelect);

                // Clear and rebuild
                while (bgSelect.options.length > 0) {
                    bgSelect.remove(0);
                }

                // Add None
                const noneOpt = new Option('None', 'none');
                bgSelect.add(noneOpt);

                // Add themes
                bgThemes.forEach(theme => {
                    const opt = new Option(theme.displayName, theme.value);
                    bgSelect.add(opt);
                    log('Added option: ' + theme.displayName);
                });

                log('Final background select options: ' + bgSelect.options.length);

            } catch (err) {
                log('Background error: ' + err);
            }
        }

        function checkSelects() {
            const borderSelect = document.getElementById('borderThemeSelect');
            const bgSelect = document.getElementById('backgroundThemeSelect');

            log('\n=== SELECT STATE CHECK ===');
            log('Border select:');
            log('  Element exists: ' + !!borderSelect);
            log('  Options count: ' + borderSelect.options.length);
            log('  Options: ' + Array.from(borderSelect.options).map(o => o.value + ':' + o.text).join(', '));
            log('  Selected value: ' + borderSelect.value);
            log('  Selected index: ' + borderSelect.selectedIndex);

            log('\nBackground select:');
            log('  Element exists: ' + !!bgSelect);
            log('  Options count: ' + bgSelect.options.length);
            log('  Options: ' + Array.from(bgSelect.options).map(o => o.value + ':' + o.text).join(', '));
            log('  Selected value: ' + bgSelect.value);
            log('  Selected index: ' + bgSelect.selectedIndex);
        }

        // Auto-test on load
        window.addEventListener('DOMContentLoaded', () => {
            log('Page loaded. Running automatic test...\n');
            testDirectAPI();
        });
    </script>
</body>
</html>