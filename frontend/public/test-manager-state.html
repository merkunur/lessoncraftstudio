<!DOCTYPE html>
<html>
<head>
  <title>ImageLibraryManager State Test</title>
</head>
<body>
  <h1>Checking ImageLibraryManager State</h1>

  <h2>Manager State:</h2>
  <pre id="managerState">Loading...</pre>

  <h2>Border Styles from Manager:</h2>
  <pre id="borderStyles">Loading...</pre>

  <h2>Testing Direct Population:</h2>
  <select id="directBorderSelect">
    <option value="none">None</option>
  </select>

  <pre id="log"></pre>

  <script>
    function log(msg) {
      document.getElementById('log').textContent += msg + '\n';
      console.log(msg);
    }

    async function checkManagerState() {
      log('=== Checking ImageLibraryManager State ===');

      // First, trigger a sync by calling the API
      try {
        log('Calling /api/borders/themes to trigger sync...');
        const response = await fetch('/api/borders/themes');
        const themes = await response.json();

        document.getElementById('borderStyles').textContent = JSON.stringify(themes, null, 2);
        log('API returned ' + themes.length + ' themes');

        // Now populate the select directly
        const select = document.getElementById('directBorderSelect');

        // Method 1: Clear and rebuild
        select.innerHTML = '<option value="none">None</option>';

        themes.forEach(theme => {
          const option = document.createElement('option');
          option.value = theme.value;
          option.text = theme.displayName;
          select.add(option);
        });

        log('Direct select now has ' + select.options.length + ' options');

        // Check if options are actually there
        log('\nOptions in select:');
        for (let i = 0; i < select.options.length; i++) {
          log('  ' + i + ': ' + select.options[i].value + ' = ' + select.options[i].text);
        }

      } catch (error) {
        log('Error: ' + error);
      }

      // Check localStorage to see if data is cached
      log('\n=== Checking localStorage ===');
      const keys = Object.keys(localStorage);
      const imageLibraryKeys = keys.filter(k => k.includes('image') || k.includes('border') || k.includes('background'));
      log('Image library related keys in localStorage: ' + imageLibraryKeys.length);
      imageLibraryKeys.forEach(key => {
        const value = localStorage.getItem(key);
        log('  ' + key + ': ' + (value ? value.substring(0, 50) + '...' : 'null'));
      });
    }

    // Run on load
    window.addEventListener('DOMContentLoaded', checkManagerState);
  </script>
</body>
</html>