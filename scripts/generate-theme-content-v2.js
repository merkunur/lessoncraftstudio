/**
 * @deprecated — SUPERSEDED by enriched content system
 *
 * This script generated the legacy theme-page-content.ts monolith.
 * The enriched content system (frontend/content/themes/) now provides
 * richer, per-file content for all 50 themes x 11 locales.
 *
 * Kept for historical reference only. Do not run.
 *
 * Original description:
 * Generate theme page content v2 - improved English + category locale templates
 * Architecture:
 *  - English content: unique intros (100-150 words) + 5 FAQs per theme
 *  - Non-English: 8 category-specific templates per locale (not 1 generic template)
 *  - Output: frontend/config/theme-page-content.ts
 */
const fs = require("fs");
const path = require("path");

// ── Load modular data files ──────────────────────────────────────
const themesAnimal = require("./v2-data/themes-animal");
const themesAcademic = require("./v2-data/themes-academic");
const themesNature = require("./v2-data/themes-nature");
const themesCreative = require("./v2-data/themes-creative");
const themesCulture = require("./v2-data/themes-culture");
const themesDaily = require("./v2-data/themes-daily");
const themesAdventure = require("./v2-data/themes-adventure");
const themesActive = require("./v2-data/themes-active");
const localeTemplates = require("./v2-data/locale-templates");

const ALL_THEMES = [
  ...themesAnimal, ...themesAcademic, ...themesNature, ...themesCreative,
  ...themesCulture, ...themesDaily, ...themesAdventure, ...themesActive,
];

const ALL_APPS = [
  "image-addition", "math-worksheet", "chart-count-color", "code-addition",
  "math-puzzle", "more-less", "subtraction", "alphabet-train", "word-scramble",
  "prepositions", "writing-app", "word-search", "image-crossword", "word-guess",
  "coloring", "draw-and-color", "sudoku", "image-cryptogram", "odd-one-out",
  "picture-path", "find-and-count", "find-objects", "missing-pieces",
  "matching-app", "grid-match", "shadow-match", "picture-sort", "drawing-lines",
  "pattern-train", "pattern-worksheet", "picture-bingo", "big-small-app",
  "treasure-hunt",
];

const LOCALES = ["de", "fr", "es", "pt", "it", "nl", "sv", "da", "no", "fi"];

// ── Helpers ──────────────────────────────────────────────────────

function escapeStr(s) {
  return s
    .replace(/\\/g, "\\\\")
    .replace(/'/g, "\\'")
    .replace(/\n/g, "\\n");
}

function fmtFaq(faqArr) {
  const items = faqArr.map(
    (f) => `        { question: '${escapeStr(f.q)}', answer: '${escapeStr(f.a)}' }`
  );
  return `[\n${items.join(",\n")},\n      ]`;
}

function fmtRelated(arr) {
  return `[${arr.map((t) => `'${t}'`).join(", ")}]`;
}

// Apply {THEME} placeholder replacement in locale templates
function applyTemplate(template, displayName) {
  if (!template) return "";
  return template.replace(/\{THEME\}/g, displayName);
}

// ── Generate ─────────────────────────────────────────────────────

let out = `/**
 * Theme Landing Page Content
 *
 * Content for /[locale]/worksheets/[theme]/ pages.
 * Each theme has localized SEO metadata, intro text, FAQ, and app mappings.
 *
 * AUTO-GENERATED by scripts/generate-theme-content-v2.js
 * To regenerate: node scripts/generate-theme-content-v2.js
 */

// ── Types ─────────────────────────────────────────────────────────

export interface ThemePageContent {
  name: string;
  title: string;
  description: string;
  keywords: string;
  heading: string;
  intro: string;
  appIds: string[];
  faq: Array<{ question: string; answer: string }>;
  relatedThemes: string[];
}

export type ThemeContentMap = Record<string, Record<string, ThemePageContent>>;

// ── All 33 App IDs ────────────────────────────────────────────────

const ALL_APPS = [
  'image-addition', 'math-worksheet', 'chart-count-color', 'code-addition',
  'math-puzzle', 'more-less', 'subtraction', 'alphabet-train', 'word-scramble',
  'prepositions', 'writing-app', 'word-search', 'image-crossword', 'word-guess',
  'coloring', 'draw-and-color', 'sudoku', 'image-cryptogram', 'odd-one-out',
  'picture-path', 'find-and-count', 'find-objects', 'missing-pieces',
  'matching-app', 'grid-match', 'shadow-match', 'picture-sort', 'drawing-lines',
  'pattern-train', 'pattern-worksheet', 'picture-bingo', 'big-small-app',
  'treasure-hunt',
];

// ── Theme Content ─────────────────────────────────────────────────

export const themeContent: ThemeContentMap = {
`;

for (const theme of ALL_THEMES) {
  // ── English block ──
  out += `  '${theme.id}': {\n`;
  out += `    en: {\n`;
  out += `      name: '${escapeStr(theme.displayNames.en)}',\n`;
  out += `      title: 'Free ${escapeStr(theme.displayNames.en)} Worksheets for Kids | LessonCraftStudio',\n`;
  out += `      description: '${escapeStr(theme.enDescription)}',\n`;
  out += `      keywords: '${escapeStr(theme.enKeywords)}',\n`;
  out += `      heading: 'Free ${escapeStr(theme.displayNames.en)} Worksheets for Kids',\n`;
  out += `      intro: '${escapeStr(theme.enIntro)}',\n`;
  out += `      appIds: ALL_APPS,\n`;
  out += `      faq: ${fmtFaq(theme.enFaq)},\n`;
  out += `      relatedThemes: ${fmtRelated(theme.relatedThemes)},\n`;
  out += `    },\n`;

  // ── Non-English locale blocks ──
  for (const locale of LOCALES) {
    const tpl = localeTemplates[locale];
    if (!tpl) continue;

    const displayName = theme.displayNames[locale] || theme.displayNames.en;
    const category = theme.category;

    // Get category-specific or fallback templates
    const catTpl = tpl.categories[category] || tpl.categories.animal;
    const baseTpl = tpl.base;

    const title = applyTemplate(baseTpl.title, displayName);
    const description = applyTemplate(baseTpl.description, displayName);
    const keywords = applyTemplate(baseTpl.keywords, displayName);
    const heading = applyTemplate(baseTpl.heading, displayName);
    const intro = applyTemplate(catTpl.intro, displayName);

    const faq = catTpl.faq.map((f) => ({
      q: applyTemplate(f.q, displayName),
      a: applyTemplate(f.a, displayName),
    }));

    out += `    ${locale}: {\n`;
    out += `      name: '${escapeStr(displayName)}',\n`;
    out += `      title: '${escapeStr(title)}',\n`;
    out += `      description: '${escapeStr(description)}',\n`;
    out += `      keywords: '${escapeStr(keywords)}',\n`;
    out += `      heading: '${escapeStr(heading)}',\n`;
    out += `      intro: '${escapeStr(intro)}',\n`;
    out += `      appIds: ALL_APPS,\n`;
    out += `      faq: ${fmtFaq(faq)},\n`;
    out += `      relatedThemes: ${fmtRelated(theme.relatedThemes)},\n`;
    out += `    },\n`;
  }

  out += `  },\n`;
}

out += `};

// ── Helper: Get content for a theme + locale (with English fallback) ──

export function getThemeContent(themeId: string, locale: string): ThemePageContent | undefined {
  return themeContent[themeId]?.[locale] ?? themeContent[themeId]?.en;
}

export function getThemeIds(): string[] {
  return Object.keys(themeContent);
}
`;

// ── Write output ─────────────────────────────────────────────────

const outPath = path.join(__dirname, "..", "frontend", "config", "theme-page-content.ts");
fs.writeFileSync(outPath, out, "utf8");

const themeCount = ALL_THEMES.length;
const localeCount = LOCALES.length + 1; // +1 for English
const totalEntries = themeCount * localeCount;
console.log(`\u2713 Generated ${outPath}`);
console.log(`  ${themeCount} themes \u00d7 ${localeCount} locales = ${totalEntries} entries`);
console.log(`  File size: ${(fs.statSync(outPath).size / 1024).toFixed(1)} KB`);
