<!DOCTYPE html>
<html>
<head>
    <title>Find Count - Final Test</title>
    <style>
        body { padding: 20px; font-family: Arial; }
        .container { display: flex; gap: 20px; }
        .section { flex: 1; border: 1px solid #ccc; padding: 10px; }
        select { width: 100%; padding: 5px; margin: 10px 0; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 10px; }
        .image-item { border: 1px solid #ddd; padding: 5px; cursor: pointer; }
        .image-item img { width: 100%; height: auto; }
        .image-item.selected { border-color: #007bff; background: #e7f3ff; }
        #status { background: #f0f0f0; padding: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Find Count - Complete Test</h1>

    <div class="container">
        <div class="section">
            <h3>Borders</h3>
            <select id="borderThemeSelect">
                <option value="none">None</option>
            </select>
            <div id="borderDictionary" class="image-grid">
                <p>Select a theme to see borders.</p>
            </div>
        </div>

        <div class="section">
            <h3>Backgrounds</h3>
            <select id="backgroundThemeSelect">
                <option value="none">None</option>
            </select>
            <div id="backgroundDictionary" class="image-grid">
                <p>Select a theme for backgrounds.</p>
            </div>
        </div>
    </div>

    <div id="status">
        <h3>Status:</h3>
        <div id="statusLog"></div>
    </div>

    <script>
        const currentLocale = 'en';
        const statusLog = document.getElementById('statusLog');

        function log(msg) {
            console.log(msg);
            const time = new Date().toISOString().split('T')[1].split('.')[0];
            statusLog.innerHTML += '<div>' + time + ' - ' + msg + '</div>';
        }

        // Populate border themes
        async function populateBorderThemes() {
            log('Loading border themes...');
            const borderThemeSelect = document.getElementById('borderThemeSelect');

            try {
                const response = await fetch('/api/borders/themes?locale=' + currentLocale);
                const themes = await response.json();
                log('Loaded ' + themes.length + ' border themes');

                borderThemeSelect.innerHTML = '<option value="none">None</option>';
                themes.forEach(theme => {
                    const option = document.createElement('option');
                    option.value = theme.value;
                    option.textContent = theme.displayName || theme.value;
                    borderThemeSelect.appendChild(option);
                });
            } catch (error) {
                log('ERROR loading border themes: ' + error.message);
            }
        }

        // Populate background themes
        async function populateBackgroundThemes() {
            log('Loading background themes...');
            const backgroundThemeSelect = document.getElementById('backgroundThemeSelect');

            try {
                const response = await fetch('/api/backgrounds/themes?locale=' + currentLocale);
                const themes = await response.json();
                log('Loaded ' + themes.length + ' background themes');

                backgroundThemeSelect.innerHTML = '<option value="none">None</option>';
                themes.forEach(theme => {
                    const option = document.createElement('option');
                    option.value = theme.value;
                    option.textContent = theme.displayName || theme.value;
                    backgroundThemeSelect.appendChild(option);
                });
            } catch (error) {
                log('ERROR loading background themes: ' + error.message);
            }
        }

        // Load border images
        async function loadBorderImages() {
            const theme = document.getElementById('borderThemeSelect').value;
            const borderDictionary = document.getElementById('borderDictionary');

            if (theme === 'none') {
                borderDictionary.innerHTML = '<p>Select a theme to see borders.</p>';
                return;
            }

            log('Loading border images for theme: ' + theme);
            borderDictionary.innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch('/api/borders/images?theme=' + theme);
                const data = await response.json();
                const images = data.images || data;

                borderDictionary.innerHTML = '';
                if (!images || images.length === 0) {
                    borderDictionary.innerHTML = '<p>No borders found.</p>';
                    return;
                }

                log('Displaying ' + images.length + ' border images');
                images.forEach(img => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.innerHTML = '<img src="' + (img.url || img.path) + '" alt="' + img.name + '" />';
                    item.onclick = () => {
                        document.querySelectorAll('#borderDictionary .image-item').forEach(el => el.classList.remove('selected'));
                        item.classList.add('selected');
                        log('Selected border: ' + img.name);
                    };
                    borderDictionary.appendChild(item);
                });
            } catch (error) {
                log('ERROR loading border images: ' + error.message);
                borderDictionary.innerHTML = '<p>Error loading borders.</p>';
            }
        }

        // Load background images
        async function loadBackgroundImages() {
            const theme = document.getElementById('backgroundThemeSelect').value;
            const backgroundDictionary = document.getElementById('backgroundDictionary');

            if (theme === 'none') {
                backgroundDictionary.innerHTML = '<p>Select a theme for backgrounds.</p>';
                return;
            }

            log('Loading background images for theme: ' + theme);
            backgroundDictionary.innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch('/api/backgrounds/images?theme=' + theme);
                const data = await response.json();
                const images = data.images || data;

                backgroundDictionary.innerHTML = '';
                if (!images || images.length === 0) {
                    backgroundDictionary.innerHTML = '<p>No backgrounds found.</p>';
                    return;
                }

                log('Displaying ' + images.length + ' background images');
                images.forEach(img => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.innerHTML = '<img src="' + (img.url || img.path) + '" alt="' + img.name + '" />';
                    item.onclick = () => {
                        document.querySelectorAll('#backgroundDictionary .image-item').forEach(el => el.classList.remove('selected'));
                        item.classList.add('selected');
                        log('Selected background: ' + img.name);
                    };
                    backgroundDictionary.appendChild(item);
                });
            } catch (error) {
                log('ERROR loading background images: ' + error.message);
                backgroundDictionary.innerHTML = '<p>Error loading backgrounds.</p>';
            }
        }

        // Initialize
        async function init() {
            log('Initializing...');

            // Load themes
            await populateBorderThemes();
            await populateBackgroundThemes();

            // Add event listeners
            document.getElementById('borderThemeSelect').addEventListener('change', loadBorderImages);
            document.getElementById('backgroundThemeSelect').addEventListener('change', loadBackgroundImages);

            log('Initialization complete!');
        }

        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>