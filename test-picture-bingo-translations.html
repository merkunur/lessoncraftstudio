<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Picture Bingo Translations</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .language-btn {
            padding: 10px;
            border: 2px solid #007aff;
            background: white;
            color: #007aff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .language-btn:hover {
            background: #007aff;
            color: white;
        }
        .language-btn.active {
            background: #007aff;
            color: white;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-results {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .test-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: #007aff; }
    </style>
</head>
<body>
    <h1>🌍 Picture Bingo Multi-Language Translation Test</h1>

    <div class="test-section">
        <h2>1️⃣ Quick Language Switcher</h2>
        <p>Click a language to test the Picture Bingo app in that language:</p>
        <div class="language-grid">
            <button class="language-btn" onclick="loadLanguage('en')">🇬🇧 English</button>
            <button class="language-btn" onclick="loadLanguage('de')">🇩🇪 Deutsch (German)</button>
            <button class="language-btn" onclick="loadLanguage('fr')">🇫🇷 Français (French)</button>
            <button class="language-btn" onclick="loadLanguage('es')">🇪🇸 Español (Spanish)</button>
            <button class="language-btn" onclick="loadLanguage('it')">🇮🇹 Italiano (Italian)</button>
            <button class="language-btn" onclick="loadLanguage('pt')">🇵🇹 Português (Portuguese)</button>
            <button class="language-btn" onclick="loadLanguage('nl')">🇳🇱 Nederlands (Dutch)</button>
            <button class="language-btn" onclick="loadLanguage('sv')">🇸🇪 Svenska (Swedish)</button>
            <button class="language-btn" onclick="loadLanguage('da')">🇩🇰 Dansk (Danish)</button>
            <button class="language-btn" onclick="loadLanguage('no')">🇳🇴 Norsk (Norwegian)</button>
            <button class="language-btn" onclick="loadLanguage('fi')">🇫🇮 Suomi (Finnish)</button>
        </div>
    </div>

    <div class="test-section">
        <h2>2️⃣ Translation Coverage Test</h2>
        <button onclick="testTranslations()">Run Translation Tests</button>
        <div id="testResults" class="test-results" style="display:none;">
            <h3>Test Results:</h3>
            <div id="testContent"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>3️⃣ Live Preview</h2>
        <p>Current Language: <span id="currentLang" class="info">English (en)</span></p>
        <iframe id="bingoFrame" src="frontend/public/worksheet-generators/bingo.html?locale=en"></iframe>
    </div>

    <script>
        function loadLanguage(locale) {
            const iframe = document.getElementById('bingoFrame');
            iframe.src = `frontend/public/worksheet-generators/bingo.html?locale=${locale}`;

            // Update button states
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update current language display
            const langNames = {
                'en': 'English',
                'de': 'Deutsch (German)',
                'fr': 'Français (French)',
                'es': 'Español (Spanish)',
                'it': 'Italiano (Italian)',
                'pt': 'Português (Portuguese)',
                'nl': 'Nederlands (Dutch)',
                'sv': 'Svenska (Swedish)',
                'da': 'Dansk (Danish)',
                'no': 'Norsk (Norwegian)',
                'fi': 'Suomi (Finnish)'
            };
            document.getElementById('currentLang').textContent = `${langNames[locale]} (${locale})`;
        }

        function testTranslations() {
            const resultsDiv = document.getElementById('testResults');
            const contentDiv = document.getElementById('testContent');
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '<p class="info">Running tests...</p>';

            const criticalKeys = [
                { key: 'background', expected: 'Background section should be translated' },
                { key: 'border', expected: 'Border section should be translated' },
                { key: 'grayscale', expected: 'Grayscale option should be translated' },
                { key: 'worksheetSettings', expected: 'Main header should be translated' },
                { key: 'generate', expected: 'Generate button should be translated' },
                { key: 'download', expected: 'Download button should be translated' },
                { key: 'bingoCardSettings', expected: 'Bingo settings section should be translated' },
                { key: 'cardsAndChips', expected: 'Cards + Chips tab should be translated' },
                { key: 'callouts', expected: 'Call-outs tab should be translated' }
            ];

            const languages = ['en', 'de', 'fr', 'es', 'it', 'pt', 'nl', 'sv', 'da', 'no', 'fi'];
            let testHtml = '';

            // Test each language
            languages.forEach(lang => {
                testHtml += `<div class="test-item"><strong>Testing ${lang}:</strong> `;

                // Create a test iframe for this language
                const testFrame = document.createElement('iframe');
                testFrame.style.display = 'none';
                testFrame.src = `frontend/public/worksheet-generators/bingo.html?locale=${lang}`;
                document.body.appendChild(testFrame);

                testFrame.onload = function() {
                    try {
                        const doc = testFrame.contentDocument || testFrame.contentWindow.document;

                        // Check if translations are loaded
                        const hasTranslations = testFrame.contentWindow.PICTURE_BINGO_TRANSLATIONS !== undefined;

                        if (hasTranslations) {
                            const translations = testFrame.contentWindow.PICTURE_BINGO_TRANSLATIONS[lang];
                            if (translations) {
                                const keyCount = Object.keys(translations).length;
                                testHtml += `<span class="success">✅ ${keyCount} keys found</span>`;

                                // Test critical keys
                                let missingKeys = [];
                                criticalKeys.forEach(item => {
                                    if (!translations[item.key]) {
                                        missingKeys.push(item.key);
                                    }
                                });

                                if (missingKeys.length > 0) {
                                    testHtml += `<span class="error"> ⚠️ Missing critical keys: ${missingKeys.join(', ')}</span>`;
                                }
                            } else {
                                testHtml += `<span class="error">❌ No translations for ${lang}</span>`;
                            }
                        } else {
                            testHtml += `<span class="error">❌ Translations not loaded</span>`;
                        }
                    } catch (e) {
                        testHtml += `<span class="error">❌ Error: ${e.message}</span>`;
                    }

                    // Clean up test frame
                    document.body.removeChild(testFrame);
                    testHtml += '</div>';
                    contentDiv.innerHTML = testHtml;
                };
            });

            // Additional validation tests
            setTimeout(() => {
                testHtml += '<h4>Critical Element Tests:</h4>';

                // Check current iframe
                const currentFrame = document.getElementById('bingoFrame');
                if (currentFrame.contentWindow) {
                    try {
                        const doc = currentFrame.contentDocument || currentFrame.contentWindow.document;

                        // Check for data-translate attributes
                        const elementsWithTranslate = doc.querySelectorAll('[data-translate]');
                        testHtml += `<div class="test-item">Elements with data-translate: <span class="info">${elementsWithTranslate.length} found</span></div>`;

                        // Check critical elements
                        const criticalElements = [
                            { selector: '[data-translate="background"]', name: 'Background' },
                            { selector: '[data-translate="border"]', name: 'Border' },
                            { selector: '[data-translate="grayscale"]', name: 'Grayscale' },
                            { selector: '[data-translate="worksheetSettings"]', name: 'Worksheet Settings' },
                            { selector: '[data-translate="generate"]', name: 'Generate Button' }
                        ];

                        criticalElements.forEach(elem => {
                            const found = doc.querySelector(elem.selector);
                            if (found) {
                                testHtml += `<div class="test-item">${elem.name}: <span class="success">✅ Found</span></div>`;
                            } else {
                                testHtml += `<div class="test-item">${elem.name}: <span class="error">❌ Not found</span></div>`;
                            }
                        });

                        // Check if t() function exists
                        if (currentFrame.contentWindow.t && typeof currentFrame.contentWindow.t === 'function') {
                            testHtml += `<div class="test-item">t() function: <span class="success">✅ Available</span></div>`;

                            // Test a few translations
                            const testKey = currentFrame.contentWindow.t('generate');
                            testHtml += `<div class="test-item">t('generate') returns: <span class="info">"${testKey}"</span></div>`;
                        } else {
                            testHtml += `<div class="test-item">t() function: <span class="error">❌ Not available</span></div>`;
                        }

                    } catch (e) {
                        testHtml += `<div class="test-item error">Error accessing iframe: ${e.message}</div>`;
                    }
                }

                contentDiv.innerHTML = testHtml;
            }, 2000);
        }

        // Auto-load English on page load
        window.onload = function() {
            document.querySelector('.language-btn').classList.add('active');
        };
    </script>
</body>
</html>