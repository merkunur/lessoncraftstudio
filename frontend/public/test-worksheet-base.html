<!DOCTYPE html>
<html>
<head>
    <title>WorksheetBase Test</title>
    <script src="worksheet-generators/js/worksheet-base.js"></script>
</head>
<body>
    <h1>WorksheetBase Conflict Test</h1>

    <select id="borderThemeSelect">
        <option value="none">None</option>
    </select>

    <div id="log"></div>

    <script>
        // Create WorksheetBase instance like in v2 apps
        const worksheetApp = new WorksheetBase({
            apiVersion: 'v2',
            enableCaching: true,
            cacheTTL: 5 * 60 * 1000,
            enableLazyLoad: true,
            defaultTheme: 'animals'
        });

        // Define a local loadBorderThemes function
        async function loadBorderThemes() {
            console.log('Local loadBorderThemes called');
            try {
                const response = await fetch('/api/borders/themes');
                const themes = await response.json();
                console.log('Themes:', themes);

                const select = document.getElementById('borderThemeSelect');
                select.innerHTML = '<option value="none">None</option>';

                themes.forEach(theme => {
                    const themeValue = typeof theme === 'string' ? theme : theme.value;
                    const displayName = typeof theme === 'string'
                        ? theme.charAt(0).toUpperCase() + theme.slice(1)
                        : (theme.displayName.charAt(0).toUpperCase() + theme.displayName.slice(1));
                    select.innerHTML += `<option value="${themeValue}">${displayName}</option>`;
                });

                document.getElementById('log').innerHTML += '<p>Options added: ' + select.options.length + '</p>';
                return true;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('log').innerHTML += '<p>Error: ' + error + '</p>';
                return false;
            }
        }

        // Test what happens when we call it
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM loaded, testing...');

            // Check what loadBorderThemes refers to
            console.log('typeof loadBorderThemes:', typeof loadBorderThemes);
            console.log('typeof worksheetApp.loadBorderThemes:', typeof worksheetApp.loadBorderThemes);
            console.log('loadBorderThemes === worksheetApp.loadBorderThemes?', loadBorderThemes === worksheetApp.loadBorderThemes);

            document.getElementById('log').innerHTML = '<p>Testing function calls...</p>';

            // Call the local function
            console.log('Calling local function...');
            const result = await loadBorderThemes();
            console.log('Local function result:', result);

            // Check select state
            const select = document.getElementById('borderThemeSelect');
            document.getElementById('log').innerHTML += '<p>Final options: ' + select.options.length + '</p>';
            document.getElementById('log').innerHTML += '<p>Options: ' + Array.from(select.options).map(o => o.value).join(', ') + '</p>';
        });
    </script>
</body>
</html>