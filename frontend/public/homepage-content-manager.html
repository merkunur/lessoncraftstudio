<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage Content Manager - LessonCraftStudio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: #f0f0f0;
            color: #666;
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tab:hover:not(.active) {
            background: #e0e0e0;
        }

        .content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .item-list {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .item-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .item-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .item-card p {
            color: #666;
            margin-bottom: 15px;
        }

        .language-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .lang-tab {
            padding: 8px 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .lang-tab.active {
            background: #667eea;
            color: white;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f0f0f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: #f8f8f8;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .sample-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sample-card {
            background: #f8f8f8;
            border-radius: 8px;
            overflow: hidden;
        }

        .sample-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #e0e0e0;
        }

        .sample-content {
            padding: 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
        }

        .badge.easy {
            background: #10b981;
        }

        .badge.medium {
            background: #f59e0b;
        }

        .badge.hard {
            background: #ef4444;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            color: #333;
            margin: 0;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 Homepage Content Manager</h1>
            <p>Manage all content on your LessonCraftStudio homepage in 11 languages</p>
            <div style="background: #f8f8f8; padding: 10px; border-radius: 5px; margin-top: 15px; font-size: 12px;">
                <strong>Languages:</strong>
                🇬🇧 English • 🇩🇪 German • 🇫🇷 French • 🇪🇸 Spanish • 🇮🇹 Italian •
                🇵🇹 Portuguese • 🇳🇱 Dutch • 🇸🇪 Swedish • 🇩🇰 Danish • 🇳🇴 Norwegian • 🇫🇮 Finnish
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('hero')">Hero Section</button>
            <button class="tab" onclick="switchTab('features')">Features</button>
            <button class="tab" onclick="switchTab('samples')">Worksheet Samples</button>
            <button class="tab" onclick="switchTab('pricing')">Pricing</button>
            <button class="tab" onclick="switchTab('seo')">SEO Settings</button>
        </div>

        <div class="content">
            <div id="message" class="message"></div>

            <!-- Hero Section -->
            <div id="hero-section" class="section active">
                <h2>Hero Section</h2>
                <p style="color: #666; margin-bottom: 20px;">The main headline and call-to-action area at the top of your homepage</p>

                <div class="language-tabs">
                    <button class="lang-tab active" onclick="switchLanguage('hero', 'en')">🇬🇧 EN</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'de')">🇩🇪 DE</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'fr')">🇫🇷 FR</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'es')">🇪🇸 ES</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'it')">🇮🇹 IT</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'pt')">🇵🇹 PT</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'nl')">🇳🇱 NL</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'sv')">🇸🇪 SV</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'da')">🇩🇰 DA</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'no')">🇳🇴 NO</button>
                    <button class="lang-tab" onclick="switchLanguage('hero', 'fi')">🇫🇮 FI</button>
                </div>

                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="hero-title" placeholder="Create Professional Worksheets in Minutes">
                </div>

                <div class="form-group">
                    <label>Subtitle</label>
                    <textarea id="hero-subtitle" placeholder="33 powerful worksheet generators with 100+ themed images"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Primary Button Text</label>
                        <input type="text" id="hero-cta-primary-text" placeholder="Try Word Search Free">
                    </div>
                    <div class="form-group">
                        <label>Primary Button Link</label>
                        <input type="text" id="hero-cta-primary-link" placeholder="/apps/word-search">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Secondary Button Text</label>
                        <input type="text" id="hero-cta-secondary-text" placeholder="View All Apps">
                    </div>
                    <div class="form-group">
                        <label>Secondary Button Link</label>
                        <input type="text" id="hero-cta-secondary-link" placeholder="/apps">
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveHeroSection()">Save Hero Section</button>
                    <button class="btn btn-secondary" onclick="loadContent()">Reset</button>
                </div>
            </div>

            <!-- Features Section -->
            <div id="features-section" class="section">
                <h2>Features</h2>
                <p style="color: #666; margin-bottom: 20px;">Highlight the key features of your platform</p>

                <button class="btn btn-primary" onclick="addNewFeature()">+ Add New Feature</button>

                <div id="features-list" class="feature-grid"></div>
            </div>

            <!-- Samples Section -->
            <div id="samples-section" class="section">
                <h2>Worksheet Samples</h2>
                <p style="color: #666; margin-bottom: 20px;">Showcase example worksheets from your generators</p>

                <button class="btn btn-primary" onclick="addNewSample()">+ Add New Sample</button>

                <div id="samples-list" class="sample-grid"></div>
            </div>

            <!-- Pricing Section -->
            <div id="pricing-section" class="section">
                <h2>Pricing Tiers</h2>
                <p style="color: #666; margin-bottom: 20px;">Configure your subscription plans and pricing</p>

                <button class="btn btn-primary" onclick="addNewPricingTier()">+ Add New Pricing Tier</button>

                <div id="pricing-list" class="item-list"></div>
            </div>

            <!-- SEO Section -->
            <div id="seo-section" class="section">
                <h2>SEO Settings</h2>
                <p style="color: #666; margin-bottom: 20px;">Optimize your homepage for search engines</p>

                <div class="language-tabs">
                    <button class="lang-tab active" onclick="switchLanguage('seo', 'en')">🇬🇧 EN</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'de')">🇩🇪 DE</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'fr')">🇫🇷 FR</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'es')">🇪🇸 ES</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'it')">🇮🇹 IT</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'pt')">🇵🇹 PT</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'nl')">🇳🇱 NL</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'sv')">🇸🇪 SV</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'da')">🇩🇰 DA</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'no')">🇳🇴 NO</button>
                    <button class="lang-tab" onclick="switchLanguage('seo', 'fi')">🇫🇮 FI</button>
                </div>

                <div class="form-group">
                    <label>Page Title</label>
                    <input type="text" id="seo-title" placeholder="LessonCraftStudio - Professional Worksheet Generator">
                </div>

                <div class="form-group">
                    <label>Meta Description</label>
                    <textarea id="seo-description" placeholder="33 powerful worksheet generators with 100+ themed images..."></textarea>
                </div>

                <div class="form-group">
                    <label>Keywords (comma-separated)</label>
                    <input type="text" id="seo-keywords" placeholder="worksheet generator, teachers pay teachers, educational resources">
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveSEOSettings()">Save SEO Settings</button>
                    <button class="btn btn-secondary" onclick="loadContent()">Reset</button>
                </div>
            </div>

            <div class="loading">
                <div class="spinner"></div>
                <p style="margin-top: 20px; color: #666;">Loading content...</p>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">Edit Item</h2>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveModalData()">Save</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'hero';
        let currentLanguage = 'en';
        let homepageContent = {};
        let currentEditItem = null;
        let currentEditType = null;

        const languageNames = {
            en: 'English',
            de: 'German',
            fr: 'French',
            es: 'Spanish',
            it: 'Italian',
            pt: 'Portuguese',
            nl: 'Dutch',
            sv: 'Swedish',
            da: 'Danish',
            no: 'Norwegian',
            fi: 'Finnish'
        };

        const languageFlags = {
            en: '🇬🇧',
            de: '🇩🇪',
            fr: '🇫🇷',
            es: '🇪🇸',
            it: '🇮🇹',
            pt: '🇵🇹',
            nl: '🇳🇱',
            sv: '🇸🇪',
            da: '🇩🇰',
            no: '🇳🇴',
            fi: '🇫🇮'
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadContent();
        });

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${tab}-section`).classList.add('active');
        }

        // Switch language
        function switchLanguage(section, lang) {
            currentLanguage = lang;

            // Update language tabs
            event.target.parentElement.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update form fields with the selected language content
            updateFormFields(section);
        }

        // Load content from API
        async function loadContent() {
            showLoading(true);
            hideMessage();

            try {
                // Request raw multilingual data for the content manager
                const response = await fetch('/api/homepage/content?raw=true&locale=' + currentLanguage);
                if (response.ok) {
                    homepageContent = await response.json();
                    console.log('Loaded content:', homepageContent);
                    updateAllSections();
                    showMessage('Content loaded successfully', 'success');
                } else {
                    showMessage('Failed to load content from API, using default content', 'error');
                    // The API will return default content even on error
                    homepageContent = await response.json();
                    updateAllSections();
                }
            } catch (error) {
                console.error('Error loading content:', error);
                showMessage('Using default content', 'error');
                // Load default content structure
                loadDefaultContent();
                updateAllSections();
            } finally {
                showLoading(false);
            }
        }

        // Load default content structure
        function loadDefaultContent() {
            homepageContent = {
                hero: {
                    title: { en: 'Create Professional Worksheets in Minutes' },
                    subtitle: { en: '33 powerful worksheet generators with 100+ themed images' },
                    cta_primary_text: { en: 'Try Word Search Free' },
                    cta_primary_link: '/apps/word-search',
                    cta_secondary_text: { en: 'View All Apps' },
                    cta_secondary_link: '/apps'
                },
                features: [],
                samples: [],
                pricing: [],
                seo: {
                    title: { en: 'LessonCraftStudio - Professional Worksheet Generator' },
                    description: { en: '33 powerful worksheet generators' },
                    keywords: { en: 'worksheet generator, educational resources' }
                }
            };
        }

        // Update all sections with loaded content
        function updateAllSections() {
            updateHeroSection();
            updateFeaturesSection();
            updateSamplesSection();
            updatePricingSection();
            updateSEOSection();
        }

        // Update hero section
        function updateHeroSection() {
            if (homepageContent.hero) {
                const hero = homepageContent.hero;
                document.getElementById('hero-title').value = hero.title?.[currentLanguage] || '';
                document.getElementById('hero-subtitle').value = hero.subtitle?.[currentLanguage] || '';
                document.getElementById('hero-cta-primary-text').value = hero.cta_primary_text?.[currentLanguage] || '';
                document.getElementById('hero-cta-primary-link').value = hero.cta_primary_link || '';
                document.getElementById('hero-cta-secondary-text').value = hero.cta_secondary_text?.[currentLanguage] || '';
                document.getElementById('hero-cta-secondary-link').value = hero.cta_secondary_link || '';
            }
        }

        // Update features section
        function updateFeaturesSection() {
            const container = document.getElementById('features-list');
            container.innerHTML = '';

            if (homepageContent.features && homepageContent.features.length > 0) {
                homepageContent.features.forEach((feature, index) => {
                    const card = createFeatureCard(feature, index);
                    container.appendChild(card);
                });
            }
        }

        // Update samples section
        function updateSamplesSection() {
            const container = document.getElementById('samples-list');
            container.innerHTML = '';

            if (homepageContent.samples && homepageContent.samples.length > 0) {
                homepageContent.samples.forEach((sample, index) => {
                    const card = createSampleCard(sample, index);
                    container.appendChild(card);
                });
            }
        }

        // Update pricing section
        function updatePricingSection() {
            const container = document.getElementById('pricing-list');
            container.innerHTML = '';

            if (homepageContent.pricing && homepageContent.pricing.length > 0) {
                homepageContent.pricing.forEach((tier, index) => {
                    const card = createPricingCard(tier, index);
                    container.appendChild(card);
                });
            }
        }

        // Update SEO section
        function updateSEOSection() {
            if (homepageContent.seo) {
                const seo = homepageContent.seo;
                document.getElementById('seo-title').value = seo.title?.[currentLanguage] || '';
                document.getElementById('seo-description').value = seo.description?.[currentLanguage] || '';
                document.getElementById('seo-keywords').value = seo.keywords?.[currentLanguage] || '';
            }
        }

        // Create feature card
        function createFeatureCard(feature, index) {
            const card = document.createElement('div');
            card.className = 'feature-card';
            card.innerHTML = `
                <div class="feature-icon">${getFeatureIcon(feature.icon)}</div>
                <h3>${feature.title?.[currentLanguage] || feature.title?.en || 'Untitled'}</h3>
                <p>${feature.description?.[currentLanguage] || feature.description?.en || ''}</p>
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-secondary" onclick="editFeature(${index})">Edit</button>
                    <button class="btn btn-danger" onclick="deleteFeature(${index})">Delete</button>
                </div>
            `;
            return card;
        }

        // Create sample card
        function createSampleCard(sample, index) {
            const card = document.createElement('div');
            card.className = 'sample-card';
            card.innerHTML = `
                <img src="${sample.image_url}" alt="${sample.name?.[currentLanguage] || sample.name?.en}" class="sample-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"300\" height=\"200\" viewBox=\"0 0 300 200\"%3E%3Crect width=\"300\" height=\"200\" fill=\"%23e0e0e0\"/%3E%3Ctext x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23999\" font-family=\"system-ui\" font-size=\"16\"%3ENo Image%3C/text%3E%3C/svg%3E'">
                <div class="sample-content">
                    <h3>${sample.name?.[currentLanguage] || sample.name?.en || 'Untitled'}</h3>
                    <p>${sample.description?.[currentLanguage] || sample.description?.en || ''}</p>
                    <div style="margin: 10px 0;">
                        <span class="badge ${(sample.difficulty || 'easy').toLowerCase()}">${sample.difficulty || 'Easy'}</span>
                        <span class="badge">${sample.age_range || '5-8 years'}</span>
                        ${sample.featured ? '<span class="badge">Featured</span>' : ''}
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="editSample(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteSample(${index})">Delete</button>
                    </div>
                </div>
            `;
            return card;
        }

        // Create pricing card
        function createPricingCard(tier, index) {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <h3>${tier.name?.[currentLanguage] || tier.name?.en || 'Untitled'}</h3>
                <p style="font-size: 24px; font-weight: bold; color: #667eea;">
                    ${tier.price}${tier.price_period || ''}
                </p>
                <ul style="list-style: none; padding: 0; margin: 15px 0;">
                    ${(tier.features?.[currentLanguage] || tier.features?.en || []).map(f =>
                        `<li style="padding: 5px 0;">✅ ${f}</li>`
                    ).join('')}
                </ul>
                ${tier.highlighted ? '<div class="badge">Most Popular</div>' : ''}
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="editPricingTier(${index})">Edit</button>
                    <button class="btn btn-danger" onclick="deletePricingTier(${index})">Delete</button>
                </div>
            `;
            return card;
        }

        // Edit feature
        function editFeature(index) {
            currentEditItem = homepageContent.features[index];
            currentEditType = 'feature';
            openModal('Edit Feature', createFeatureForm(currentEditItem));
        }

        // Edit sample
        function editSample(index) {
            currentEditItem = homepageContent.samples[index];
            currentEditType = 'sample';
            openModal('Edit Worksheet Sample', createSampleForm(currentEditItem));
        }

        // Edit pricing tier
        function editPricingTier(index) {
            currentEditItem = homepageContent.pricing[index];
            currentEditType = 'pricing';
            openModal('Edit Pricing Tier', createPricingForm(currentEditItem));
        }

        // Create feature form
        function createFeatureForm(feature) {
            let html = '<div class="language-tabs">';
            Object.keys(languageNames).forEach(lang => {
                html += `<button class="lang-tab ${lang === 'en' ? 'active' : ''}" onclick="switchModalLanguage('${lang}')">${languageFlags[lang]} ${lang.toUpperCase()}</button>`;
            });
            html += '</div>';

            Object.keys(languageNames).forEach(lang => {
                html += `
                    <div class="lang-content" data-lang="${lang}" style="display: ${lang === 'en' ? 'block' : 'none'};">
                        <div class="form-group">
                            <label>Title (${languageNames[lang]})</label>
                            <input type="text" id="feature-title-${lang}" value="${feature?.title?.[lang] || ''}">
                        </div>
                        <div class="form-group">
                            <label>Description (${languageNames[lang]})</label>
                            <textarea id="feature-description-${lang}">${feature?.description?.[lang] || ''}</textarea>
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="form-group">
                    <label>Icon</label>
                    <select id="feature-icon">
                        <option value="apps" ${feature?.icon === 'apps' ? 'selected' : ''}>Apps</option>
                        <option value="images" ${feature?.icon === 'images' ? 'selected' : ''}>Images</option>
                        <option value="languages" ${feature?.icon === 'languages' ? 'selected' : ''}>Languages</option>
                        <option value="license" ${feature?.icon === 'license' ? 'selected' : ''}>License</option>
                        <option value="star" ${feature?.icon === 'star' ? 'selected' : ''}>Star</option>
                        <option value="rocket" ${feature?.icon === 'rocket' ? 'selected' : ''}>Rocket</option>
                    </select>
                </div>
            `;

            return html;
        }

        // Create sample form
        function createSampleForm(sample) {
            let html = '<div class="language-tabs">';
            Object.keys(languageNames).forEach(lang => {
                html += `<button class="lang-tab ${lang === 'en' ? 'active' : ''}" onclick="switchModalLanguage('${lang}')">${languageFlags[lang]} ${lang.toUpperCase()}</button>`;
            });
            html += '</div>';

            Object.keys(languageNames).forEach(lang => {
                html += `
                    <div class="lang-content" data-lang="${lang}" style="display: ${lang === 'en' ? 'block' : 'none'};">
                        <div class="form-group">
                            <label>Name (${languageNames[lang]})</label>
                            <input type="text" id="sample-name-${lang}" value="${sample?.name?.[lang] || ''}">
                        </div>
                        <div class="form-group">
                            <label>Description (${languageNames[lang]})</label>
                            <textarea id="sample-description-${lang}">${sample?.description?.[lang] || ''}</textarea>
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="text" id="sample-image" value="${sample?.image_url || ''}">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="sample-category">
                        <option value="math" ${sample?.category === 'math' ? 'selected' : ''}>Math</option>
                        <option value="literacy" ${sample?.category === 'literacy' ? 'selected' : ''}>Literacy</option>
                        <option value="puzzle" ${sample?.category === 'puzzle' ? 'selected' : ''}>Puzzle</option>
                        <option value="logic" ${sample?.category === 'logic' ? 'selected' : ''}>Logic</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="sample-difficulty">
                        <option value="Easy" ${sample?.difficulty === 'Easy' ? 'selected' : ''}>Easy</option>
                        <option value="Medium" ${sample?.difficulty === 'Medium' ? 'selected' : ''}>Medium</option>
                        <option value="Hard" ${sample?.difficulty === 'Hard' ? 'selected' : ''}>Hard</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Age Range</label>
                    <input type="text" id="sample-age" value="${sample?.age_range || ''}">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sample-featured" ${sample?.featured ? 'checked' : ''}> Featured
                    </label>
                </div>
            `;

            return html;
        }

        // Create pricing form
        function createPricingForm(tier) {
            let html = '<div class="language-tabs">';
            Object.keys(languageNames).forEach(lang => {
                html += `<button class="lang-tab ${lang === 'en' ? 'active' : ''}" onclick="switchModalLanguage('${lang}')">${languageFlags[lang]} ${lang.toUpperCase()}</button>`;
            });
            html += '</div>';

            Object.keys(languageNames).forEach(lang => {
                html += `
                    <div class="lang-content" data-lang="${lang}" style="display: ${lang === 'en' ? 'block' : 'none'};">
                        <div class="form-group">
                            <label>Name (${languageNames[lang]})</label>
                            <input type="text" id="pricing-name-${lang}" value="${tier?.name?.[lang] || ''}">
                        </div>
                        <div class="form-group">
                            <label>Features (${languageNames[lang]}) - one per line</label>
                            <textarea id="pricing-features-${lang}" rows="5">${(tier?.features?.[lang] || []).join('\n')}</textarea>
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="form-group">
                    <label>Price</label>
                    <input type="text" id="pricing-price" value="${tier?.price || ''}">
                </div>
                <div class="form-group">
                    <label>Price Period</label>
                    <input type="text" id="pricing-period" value="${tier?.price_period || ''}">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="pricing-highlighted" ${tier?.highlighted ? 'checked' : ''}> Highlighted (Most Popular)
                    </label>
                </div>
            `;

            return html;
        }

        // Switch modal language
        function switchModalLanguage(lang) {
            document.querySelectorAll('#modalBody .lang-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('#modalBody .lang-content').forEach(content => {
                content.style.display = content.dataset.lang === lang ? 'block' : 'none';
            });
        }

        // Open modal
        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('editModal').classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditItem = null;
            currentEditType = null;
        }

        // Save modal data
        function saveModalData() {
            if (currentEditType === 'feature') {
                saveFeatureData();
            } else if (currentEditType === 'sample') {
                saveSampleData();
            } else if (currentEditType === 'pricing') {
                savePricingData();
            }
            closeModal();
        }

        // Save feature data
        function saveFeatureData() {
            const updatedFeature = {
                ...currentEditItem,
                title: {},
                description: {},
                icon: document.getElementById('feature-icon').value
            };

            Object.keys(languageNames).forEach(lang => {
                updatedFeature.title[lang] = document.getElementById(`feature-title-${lang}`).value;
                updatedFeature.description[lang] = document.getElementById(`feature-description-${lang}`).value;
            });

            saveFeature(updatedFeature);
        }

        // Save sample data
        function saveSampleData() {
            const updatedSample = {
                ...currentEditItem,
                name: {},
                description: {},
                image_url: document.getElementById('sample-image').value,
                category: document.getElementById('sample-category').value,
                difficulty: document.getElementById('sample-difficulty').value,
                age_range: document.getElementById('sample-age').value,
                featured: document.getElementById('sample-featured').checked
            };

            Object.keys(languageNames).forEach(lang => {
                updatedSample.name[lang] = document.getElementById(`sample-name-${lang}`).value;
                updatedSample.description[lang] = document.getElementById(`sample-description-${lang}`).value;
            });

            saveSample(updatedSample);
        }

        // Save pricing data
        function savePricingData() {
            const updatedTier = {
                ...currentEditItem,
                name: {},
                features: {},
                price: document.getElementById('pricing-price').value,
                price_period: document.getElementById('pricing-period').value,
                highlighted: document.getElementById('pricing-highlighted').checked
            };

            Object.keys(languageNames).forEach(lang => {
                updatedTier.name[lang] = document.getElementById(`pricing-name-${lang}`).value;
                updatedTier.features[lang] = document.getElementById(`pricing-features-${lang}`).value.split('\n').filter(f => f.trim());
            });

            savePricingTier(updatedTier);
        }

        // Add new feature
        function addNewFeature() {
            currentEditItem = {
                title: {},
                description: {},
                icon: 'star',
                color_scheme: 'primary',
                sort_order: homepageContent.features ? homepageContent.features.length + 1 : 1
            };
            currentEditType = 'feature';
            openModal('Add New Feature', createFeatureForm(currentEditItem));
        }

        // Add new sample
        function addNewSample() {
            currentEditItem = {
                name: {},
                description: {},
                category: 'math',
                difficulty: 'Easy',
                age_range: '5-8 years',
                image_url: '/worksheet-samples/default.png',
                featured: false,
                sort_order: homepageContent.samples ? homepageContent.samples.length + 1 : 1
            };
            currentEditType = 'sample';
            openModal('Add New Sample', createSampleForm(currentEditItem));
        }

        // Add new pricing tier
        function addNewPricingTier() {
            currentEditItem = {
                name: {},
                features: {},
                price: '$0',
                price_period: '/mo',
                highlighted: false,
                sort_order: homepageContent.pricing ? homepageContent.pricing.length + 1 : 1
            };
            currentEditType = 'pricing';
            openModal('Add New Pricing Tier', createPricingForm(currentEditItem));
        }

        // Save functions
        async function saveHeroSection() {
            showLoading(true);
            hideMessage();

            const hero = {
                title: { ...homepageContent.hero?.title, [currentLanguage]: document.getElementById('hero-title').value },
                subtitle: { ...homepageContent.hero?.subtitle, [currentLanguage]: document.getElementById('hero-subtitle').value },
                cta_primary_text: { ...homepageContent.hero?.cta_primary_text, [currentLanguage]: document.getElementById('hero-cta-primary-text').value },
                cta_primary_link: document.getElementById('hero-cta-primary-link').value,
                cta_secondary_text: { ...homepageContent.hero?.cta_secondary_text, [currentLanguage]: document.getElementById('hero-cta-secondary-text').value },
                cta_secondary_link: document.getElementById('hero-cta-secondary-link').value
            };

            try {
                const response = await fetch('/api/homepage/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ section: 'hero', content: hero })
                });

                if (response.ok) {
                    showMessage('Hero section saved successfully!', 'success');
                    homepageContent.hero = hero;
                } else {
                    showMessage('Failed to save hero section', 'error');
                }
            } catch (error) {
                showMessage('Error saving hero section: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveFeature(feature) {
            showLoading(true);
            try {
                const response = await fetch('/api/homepage/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ section: 'feature', content: feature })
                });

                if (response.ok) {
                    showMessage('Feature saved successfully!', 'success');
                    loadContent();
                } else {
                    showMessage('Failed to save feature', 'error');
                }
            } catch (error) {
                showMessage('Error saving feature: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveSample(sample) {
            showLoading(true);
            try {
                const response = await fetch('/api/homepage/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ section: 'sample', content: sample })
                });

                if (response.ok) {
                    showMessage('Sample saved successfully!', 'success');
                    loadContent();
                } else {
                    showMessage('Failed to save sample', 'error');
                }
            } catch (error) {
                showMessage('Error saving sample: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function savePricingTier(tier) {
            showLoading(true);
            try {
                const response = await fetch('/api/homepage/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ section: 'pricing', content: tier })
                });

                if (response.ok) {
                    showMessage('Pricing tier saved successfully!', 'success');
                    loadContent();
                } else {
                    showMessage('Failed to save pricing tier', 'error');
                }
            } catch (error) {
                showMessage('Error saving pricing tier: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveSEOSettings() {
            showLoading(true);
            hideMessage();

            const seo = {
                title: { ...homepageContent.seo?.title, [currentLanguage]: document.getElementById('seo-title').value },
                description: { ...homepageContent.seo?.description, [currentLanguage]: document.getElementById('seo-description').value },
                keywords: { ...homepageContent.seo?.keywords, [currentLanguage]: document.getElementById('seo-keywords').value }
            };

            try {
                // For now, just update local state
                homepageContent.seo = seo;
                showMessage('SEO settings saved successfully!', 'success');
            } catch (error) {
                showMessage('Error saving SEO settings: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Delete functions
        async function deleteFeature(index) {
            if (!confirm('Are you sure you want to delete this feature?')) return;

            homepageContent.features.splice(index, 1);
            updateFeaturesSection();
            showMessage('Feature deleted successfully!', 'success');
        }

        async function deleteSample(index) {
            if (!confirm('Are you sure you want to delete this sample?')) return;

            homepageContent.samples.splice(index, 1);
            updateSamplesSection();
            showMessage('Sample deleted successfully!', 'success');
        }

        async function deletePricingTier(index) {
            if (!confirm('Are you sure you want to delete this pricing tier?')) return;

            homepageContent.pricing.splice(index, 1);
            updatePricingSection();
            showMessage('Pricing tier deleted successfully!', 'success');
        }

        // Helper functions
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            setTimeout(() => hideMessage(), 5000);
        }

        function hideMessage() {
            const messageEl = document.getElementById('message');
            messageEl.className = 'message';
        }

        function showLoading(show) {
            document.querySelector('.loading').className = show ? 'loading active' : 'loading';
        }

        function getFeatureIcon(icon) {
            const icons = {
                'apps': '📱',
                'images': '🖼️',
                'languages': '🌍',
                'license': '📜',
                'star': '⭐',
                'rocket': '🚀',
                'shield': '🛡️',
                'chart': '📊'
            };
            return icons[icon] || '✨';
        }

        function updateFormFields(section) {
            if (section === 'hero') {
                updateHeroSection();
            } else if (section === 'seo') {
                updateSEOSection();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>