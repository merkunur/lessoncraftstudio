<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Picture Bingo Dropdown Translations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-controls {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .language-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .lang-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .lang-btn:hover {
            background: #0056b3;
        }
        .lang-btn.active {
            background: #28a745;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .test-output {
            background: #333;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
    </style>
</head>
<body>
    <h1>Picture Bingo Dropdown Translation Test</h1>

    <div class="test-controls">
        <h2>Test Controls</h2>
        <button onclick="checkDropdowns()">üîç Check Current Dropdown Values</button>
        <button onclick="reloadFrame()">üîÑ Reload Application</button>
        <button onclick="clearOutput()">üóëÔ∏è Clear Output</button>
    </div>

    <div class="language-buttons">
        <button class="lang-btn" onclick="switchLanguage('en')">English</button>
        <button class="lang-btn" onclick="switchLanguage('de')">German (Deutsch)</button>
        <button class="lang-btn" onclick="switchLanguage('fr')">French (Fran√ßais)</button>
        <button class="lang-btn" onclick="switchLanguage('es')">Spanish (Espa√±ol)</button>
        <button class="lang-btn" onclick="switchLanguage('it')">Italian (Italiano)</button>
        <button class="lang-btn" onclick="switchLanguage('pt')">Portuguese (Portugu√™s)</button>
        <button class="lang-btn" onclick="switchLanguage('nl')">Dutch (Nederlands)</button>
        <button class="lang-btn" onclick="switchLanguage('sv')">Swedish (Svenska)</button>
        <button class="lang-btn" onclick="switchLanguage('da')">Danish (Dansk)</button>
        <button class="lang-btn" onclick="switchLanguage('no')">Norwegian (Norsk)</button>
        <button class="lang-btn" onclick="switchLanguage('fi')">Finnish (Suomi)</button>
    </div>

    <div class="test-output" id="output">
        <div class="info">Click a language button to load the app in that language</div>
    </div>

    <iframe id="bingoFrame" src=""></iframe>

    <script>
        let currentLang = '';
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            output.innerHTML = '<div class="info">Output cleared</div>';
        }

        function switchLanguage(lang) {
            currentLang = lang;
            log(`Loading Picture Bingo in ${lang.toUpperCase()}...`, 'info');

            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const iframe = document.getElementById('bingoFrame');
            iframe.src = `frontend/public/worksheet-generators/bingo.html?locale=${lang}`;

            iframe.onload = function() {
                log(`Application loaded with locale: ${lang}`, 'success');

                // Wait a bit for translations to load
                setTimeout(() => {
                    checkDropdowns();
                }, 1500);
            };
        }

        function reloadFrame() {
            if (currentLang) {
                switchLanguage(currentLang);
            } else {
                log('Please select a language first', 'error');
            }
        }

        function checkDropdowns() {
            const iframe = document.getElementById('bingoFrame');

            try {
                const iframeWin = iframe.contentWindow;
                const iframeDoc = iframe.contentDocument || iframeWin.document;

                log('--- Checking Dropdown Values ---', 'info');

                // Check if translations are loaded
                if (iframeWin.PICTURE_BINGO_TRANSLATIONS) {
                    log('‚úÖ Translations loaded', 'success');

                    const locale = iframeWin.currentLocale || 'en';
                    log(`Current locale: ${locale}`, 'info');

                    // Check specific translation keys
                    const translations = iframeWin.PICTURE_BINGO_TRANSLATIONS[locale];
                    if (translations) {
                        log(`'none' translates to: "${translations.none || 'MISSING'}"`, 'info');
                        log(`'allThemes' translates to: "${translations.allThemes || 'MISSING'}"`, 'info');
                    }
                } else {
                    log('‚ùå Translations not loaded', 'error');
                }

                // Check theme select (All Themes)
                const themeSelect = iframeDoc.getElementById('themeSelect');
                if (themeSelect && themeSelect.options.length > 0) {
                    const allThemesText = themeSelect.options[0].text;
                    const allThemesValue = themeSelect.options[0].value;

                    if (allThemesValue === 'all') {
                        const isTranslated = (currentLang === 'en' && allThemesText === 'All Themes') ||
                                            (currentLang !== 'en' && allThemesText !== 'All Themes');

                        if (isTranslated) {
                            log(`‚úÖ 'All Themes' dropdown shows: "${allThemesText}"`, 'success');
                        } else {
                            log(`‚ùå 'All Themes' not translated, shows: "${allThemesText}"`, 'error');
                        }
                    }
                } else {
                    log('Theme select not found or empty', 'error');
                }

                // Check border select (None)
                const borderSelect = iframeDoc.getElementById('borderThemeSelect');
                if (borderSelect && borderSelect.options.length > 0) {
                    const noneText = borderSelect.options[0].text;
                    const noneValue = borderSelect.options[0].value;

                    if (noneValue === 'none') {
                        const isTranslated = (currentLang === 'en' && noneText === 'None') ||
                                            (currentLang !== 'en' && noneText !== 'None');

                        if (isTranslated) {
                            log(`‚úÖ Border 'None' shows: "${noneText}"`, 'success');
                        } else {
                            log(`‚ùå Border 'None' not translated, shows: "${noneText}"`, 'error');
                        }
                    }
                } else {
                    log('Border select not found or empty', 'error');
                }

                // Check background select (None)
                const bgSelect = iframeDoc.getElementById('backgroundThemeSelect');
                if (bgSelect && bgSelect.options.length > 0) {
                    const noneText = bgSelect.options[0].text;
                    const noneValue = bgSelect.options[0].value;

                    if (noneValue === 'none') {
                        const isTranslated = (currentLang === 'en' && noneText === 'None') ||
                                            (currentLang !== 'en' && noneText !== 'None');

                        if (isTranslated) {
                            log(`‚úÖ Background 'None' shows: "${noneText}"`, 'success');
                        } else {
                            log(`‚ùå Background 'None' not translated, shows: "${noneText}"`, 'error');
                        }
                    }
                } else {
                    log('Background select not found or empty', 'error');
                }

                // Check if t() function exists
                if (iframeWin.t && typeof iframeWin.t === 'function') {
                    log('‚úÖ t() function is available', 'success');
                    log(`t('none') returns: "${iframeWin.t('none')}"`, 'info');
                    log(`t('allThemes') returns: "${iframeWin.t('allThemes')}"`, 'info');
                } else {
                    log('‚ùå t() function not available', 'error');
                }

            } catch (e) {
                log(`Error checking dropdowns: ${e.message}`, 'error');
            }
        }

        // Auto-load English on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                switchLanguage('en');
            }, 500);
        });
    </script>
</body>
</html>